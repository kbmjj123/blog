---
title: Object.definePropertyé‡æ–°æ¡èµ·å­¦ä¹ 
description: Object.definePropertyé‡æ–°æ¡èµ·å­¦ä¹ 
author: Zhenggl
date: 2022-03-24 19:10:53
categories:
tags:
cover_picture: Object.definePropertyå°é¢.jpg
---


### å‰è¨€
ğŸ¤” ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå¯¹è±¡çš„å±æ€§çš„æ—¶å€™ï¼Œå¯ä»¥ç®€å•çš„é€šè¿‡å¯¹è±¡å­—é¢é‡æ¥å®šä¹‰å¹¶å£°æ˜å¯¹è±¡çš„å±æ€§ï¼Œå¦‚ä¸‹ï¼š
> var obj = { a : 123 };

å®šä¹‰äº†ä¸€ä¸ªobjå¯¹è±¡ï¼Œå…¶å±æ€§açš„å€¼èµ‹ä¸º123ã€‚æ—¢ç„¶JavaScriptä¸­å·²ç»æä¾›äº†è¿™ç§æ–¹å¼æ¥å£°æ˜å®šä¹‰å¯¹è±¡ä»¥åŠå…¶å±æ€§ï¼Œä¸ºå•¥å­è¿˜è¦å¤šæ­¤ä¸€ä¸¾æ¥æä¾›`Object.defineProperty`è¿™ä¸ªé™æ€APIæ¥ç»™å¯¹è±¡å®šä¹‰å±æ€§å‘¢ï¼Ÿï¼Ÿ

âœ¨ é¦–å…ˆï¼Œå¯¹äº`Object.defineProperty()`çš„å®šä¹‰æ˜¯ï¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°çš„å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›æ­¤å¯¹è±¡ã€‚
è¿™é‡Œåœ¨å®šä¹‰å±æ€§çš„åŒæ—¶ï¼Œä¸å•å•æä¾›å±æ€§çš„å€¼ï¼Œè¿˜æä¾›äº†å±æ€§çš„*æ•°æ®æ“ä½œ*+*æ•°æ®å±æ€§æè¿°*ï¼Œè¯¥æ–¹æ³•å…è®¸**ç²¾ç¡®**åœ°æ·»åŠ æˆ–ä¿®æ”¹å¯¹è±¡çš„å±æ€§ï¼Œä¸€èˆ¬é€šè¿‡ç®€å•çš„èµ‹å€¼æ“ä½œï¼Œå…¶å±æ€§æè¿°ç¬¦ä¸­çš„å±æ€§éƒ½æ˜¯trueçš„ã€‚
> var obj = {};
> Object.defineProperty(obj, 'a', {
>   value: 123,
>   writable: 'booleanï¼Œå½“ä¸”ä»…å½“è¯¥å€¼ä¸ºtrueçš„æ—¶å€™ï¼Œæ™®é€šçš„.å±æ€§æ“ä½œç¬¦æˆ–è€…[]å±æ€§æ“ä½œç¬¦æ‰å¯ä»¥å¯¹aå±æ€§è¿›è¡Œèµ‹å€¼',
>   enumerable: 'boolean, å½“ä¸”ä»…å½“è¯¥å€¼ä¸ºtrueçš„æ—¶å€™ï¼Œè¯¥å±æ€§æ‰ä¼šå‡ºç°åœ¨å¯¹è±¡çš„æšä¸¾å±æ€§ä¸­ï¼Œä¹Ÿå°±æ˜¯Object.keys()æˆ–è€…for...ofæ–¹å¼æ¥è®¿é—®åˆ°',
>   configurable: 'boolean, å½“ä¸”ä»…å½“è¯¥å€¼ä¸ºtrueçš„æ—¶å€™ï¼Œåœ¨å®šä¹‰äº†è¯¥å±æ€§ä¹‹åï¼Œåç»­æƒ³è¦å¯¹è¿™ä¸ªå±æ€§è¿›è¡Œä¸€ä¸ªé‡æ–°é…ç½®æ“ä½œæ‰èƒ½å¤Ÿè¢«å…è®¸ï¼Œå¦åˆ™å°±æ˜¯ä¸€æ¬¡æ€§çš„æ“ä½œ',
>   get: 'function, å±æ€§çš„getterå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œåˆ™ä¸ºundefinedï¼Œå½“è®¿é—®è¯¥å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°ï¼Œæ‰§è¡Œæ—¶ä¸ä¼ å…¥ä»»ä½•å‚æ•°ï¼Œä½†æ˜¯ä¼šä¼ å…¥thisä¸Šä¸‹æ–‡',
>   set: 'function, å±æ€§çš„setterå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å®šä¹‰ï¼Œåˆ™ä¸ºundefinedï¼Œå½“å±æ€§å€¼è¢«ä¿®æ”¹æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œä½œä¸ºå¯¹è¯¥å±æ€§è¿›è¡Œèµ‹å€¼æ“ä½œçš„å€¼'
> });

é€šè¿‡å¯¹æ¯”ä¸Šè¿°ä¸¤ç§æ–¹å¼å¯¹å˜é‡açš„å®šä¹‰çœ‹ä¼¼å¥½åƒæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œå®é™…ä¸Šçš„åŒºåˆ«å·¨å¤§ï¼Œå› æ­¤å…¶ä¸­éšè—äº†å¯¹å¯¹è±¡å±æ€§çš„ä¸€ä¸ªä¿æŠ¤æœºåˆ¶ï¼Œå¹¶ä¸”é¢å¤–éšè—äº†ä¸€ç³»åˆ—å¤æ‚çš„é€»è¾‘åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ©äº`Object.defineProperty`é™æ€æ–¹æ³•æ¥å¸®åŠ©è‡ªå·±å®Œå–„å¤æ‚ä¸šåŠ¡

```javascript
  var obj = { a: 123 };
  Object.defineProperty(obj, 'b', { value: 123 });
  console.info(obj);  //æ­£å¸¸è¾“å‡ºä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§çš„åŒºåˆ«
  //---------------é€šè¿‡ä»¥ä¸‹çš„æ–¹å¼æ¥è¾“å‡ºï¼Œæˆ‘ä»¬ä¼šå‘ç°ä¸¤è€…çš„ä¸åŒç‚¹
  console.info(Object.getOwnPropertyDescriptor(obj, 'a'));
  console.info(Object.getOwnPropertyDescriptor(obj, 'b'));
```
![å¯¹è±¡çš„å±æ€§æè¿°ç¬¦åŒºåˆ«](å¯¹è±¡çš„å±æ€§æè¿°ç¬¦åŒºåˆ«.png)

âœ¨ é€šè¿‡ä¸Šè¿°çš„è¾“å‡ºç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œæ™®é€šå¯¹è±¡å­—é¢é‡æ‰€å®šä¹‰çš„å±æ€§æè¿°çš„å…¶ä»–å±æ€§éƒ½æ˜¯trueï¼Œè€Œé€šè¿‡`Object.defineProperty`å®šä¹‰çš„å±æ€§æè¿°ç¬¦çš„å±æ€§éƒ½æ˜¯false

### getterä¸setter
åœ¨å­¦ä¹ Object.definePropertyæ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä»¥ä¸‹å±æ€§çš„getterä»¥åŠsetterï¼Œä¸€èˆ¬å¯ä»¥ä½¿ç”¨ä¸¤è€…é…åˆï¼Œæ¥å®šä¹‰å¯¹è±¡å±æ€§çš„ä¸€ä¸ª**ä¼ªå±æ€§**ï¼Œè¿™é‡Œç§°ä¹‹ä¸º**ä¼ªå±æ€§**ï¼ŒåŸå› æ˜¯å› ä¸ºæˆ‘ä»¬æœ‰å¯èƒ½å¹¶ä¸æ˜¯çœŸå®ä½¿ç”¨è¿™ä¸ªå±æ€§ï¼Œ
è€Œæ˜¯å€ŸåŠ©äºè¿™ä¸ªå±æ€§ï¼Œæ¥å®ç°å…¶ä»–çš„é€»è¾‘æ“ä½œã€‚

#### getter
> `get`è¯­æ³•å°†å¯¹è±¡å±æ€§ç»‘å®šåˆ°æŸ¥è¯¢è¯¥å±æ€§æ—¶å°†è¢«è°ƒç”¨çš„å‡½æ•°
```javascript
  const obj = {
	log: [1,2,3],
	get latest(){
		if(0 === this.log.length){
			return undefined;
		}
		return this.log[this.log.length - 1];
	}
  };
  console.info(obj.latest); // 3
```
##### getterè¯­æ³•è¯´æ˜
> get prop(){...}
> get [expression](){}

**å‚æ•°ï¼š**
propï¼š è¦ç»‘å®šåˆ°å¯¹è±¡ä¸­å±æ€§åï¼Œè¿™é‡Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª[è¡¨è¾¾å¼]ï¼Œé€šè¿‡[è¡¨è¾¾å¼]å¯ä»¥åˆ©ç”¨è®¡ç®—å±æ€§åŠ¨æ€è®¾ç½®å¯¹è±¡çš„å±æ€§åç§°

**æè¿°ï¼š**
æœ‰æ—¶éœ€è¦å…è®¸è®¿é—®è¿”å›åŠ¨æ€è®¡ç®—å€¼çš„å±æ€§ï¼Œæˆ–è€…æˆ‘ä»¬å¯èƒ½éœ€è¦ååº”å†…éƒ¨å˜é‡çš„çŠ¶æ€ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨æ˜¾ç¤ºæ–¹æ³•è°ƒç”¨ï¼Œå°±å¯ä»¥ä½¿ç”¨*getter*æ¥å®ç°ã€‚

##### getteråœ¨classä¸­çš„ä½¿ç”¨
é¦–å…ˆï¼Œå…ˆçœ‹ä¸€ä¸‹çš„ä»£ç ï¼š
```javascript
  class Example{
	get hello(){
		return 'hello';
	}
  }
  const obj = new Example();
  console.info(obj.hello);
  
  console.info(Object.getOwnPropertyDescriptor(obj, 'hello'));  // undefined
  
  console.info(Object.getOwnPropertyDescriptor(Object.getPrototypeOf(obj), 'hello'));
  // { configurable: true, enumerable: false, get: function get hello() { return 'world'; }, set: undefined }
  
```
è¿™é‡Œæœ‰ä¸¤ä¸ªç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹çš„ï¼š
1. é¦–å…ˆåœ¨class Exampleä¸­å®šä¹‰çš„getterå±æ€§helloï¼Œç”±äºæ˜¯ä¸€å‡½æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºä¸æ™®é€šå‡½æ•°ä¸€æ ·ï¼Œå®šä¹‰åœ¨classå¯¹è±¡ä¸­çš„å±æ€§ï¼Œå°†ä¼šå®šä¹‰åœ¨å¯¹è±¡çš„åŸå‹ä¸Šï¼Œå› æ­¤ï¼Œæ‰ä¼šæœ‰ä¸Šè¿°çš„åœ¨objçš„prototypeä¸­æ‰æœ‰çš„helloå±æ€§ï¼›
2. å…³æ³¨åˆ°prototypeä¸­çš„helloçš„å±æ€§æè¿°ç¬¦ç›¸å…³å€¼ï¼Œç”±äºæ˜¯åœ¨obj.prototypeä¸­å®šä¹‰çš„helloå±æ€§ï¼Œå› æ­¤å¯¹åº”çš„å®ä¾‹å¯¹è±¡objå¯ä»¥é€šè¿‡åŸå‹çš„æ–¹å¼è®¿é—®åˆ°ï¼Œè€Œåœ¨å®ä¾‹ä¸­æ˜¯æ ¹æœ¬ä¸å­˜åœ¨è¿™ä¸ªå±æ€§çš„ï¼Œå› æ­¤è¯¥å±æ€§æ˜¯ä¸å¯æšä¸¾çš„ï¼›

#### setter
> å½“å°è¯•è®¾ç½®å±æ€§æ—¶ï¼Œsetè¯­æ³•å°†å¯¹è±¡å±æ€§ç»‘å®šåˆ°è¦è°ƒç”¨çš„å‡½æ•°
```javascript
  const language = {
  set current(name) {
    this.log.push(name);
  },
  log: []
};

language.current = 'EN';
language.current = 'FA';

console.log(language.log);
// expected output: Array ["EN", "FA"]

```
##### setterè¯­æ³•è¯´æ˜
> set prop(val){...}
> set [expression](val){...}
**å‚æ•°ï¼š**
propï¼š è¦ç»‘å®šåˆ°å¯¹è±¡ä¸­å±æ€§åï¼Œè¿™é‡Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª[è¡¨è¾¾å¼]ï¼Œé€šè¿‡[è¡¨è¾¾å¼]å¯ä»¥åˆ©ç”¨è®¡ç®—å±æ€§åŠ¨æ€è®¾ç½®å¯¹è±¡çš„å±æ€§åç§°

**æè¿°ï¼š**
æœ‰æ—¶éœ€è¦å…è®¸è®¿é—®è¿”å›åŠ¨æ€è®¡ç®—å€¼çš„å±æ€§ï¼Œæˆ–è€…æˆ‘ä»¬å¯èƒ½éœ€è¦ååº”å†…éƒ¨å˜é‡çš„çŠ¶æ€ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨æ˜¾ç¤ºæ–¹æ³•è°ƒç”¨ï¼Œå°±å¯ä»¥ä½¿ç”¨*setter*æ¥å®ç°ã€‚

### Object.defineProperty
> å¯¹è±¡é‡Œç›®å‰å­˜åœ¨çš„å±æ€§æè¿°ç¬¦æœ‰ä¸¤ç§ä¸»è¦å½¢å¼ï¼š*æ•°æ®æè¿°ç¬¦*å’Œ*å­˜å–æè¿°ç¬¦*ï¼Œ*æ•°æ®æè¿°ç¬¦*æ˜¯ä¸€ä¸ªå…·æœ‰å€¼çš„å±æ€§ï¼Œè¯¥å€¼å¯ä»¥æ˜¯å¯å†™çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸å¯å†™çš„ã€‚
> *å­˜å–æè¿°ç¬¦*æ˜¯æœ‰getterå‡½æ•°å’Œsetterå‡½æ•°æ‰€æè¿°çš„å±æ€§ï¼Œä¸€ä¸ªæè¿°ç¬¦åªèƒ½æ˜¯è¿™ä¸¤è€…å…¶ä¸­ä¹‹ä¸€ï¼Œä¸èƒ½åŒæ—¶æ‹¥æœ‰ã€‚

#### æ–¹æ³•è§£é‡Š
**è¯­æ³•ï¼š**
> Object.defineProperty(obj, prop, descriptor)

**å‚æ•°ï¼š**
1. obj: è¦å®šä¹‰/ä¿®æ”¹å±æ€§çš„å¯¹è±¡
2. prop: è¦å®šä¹‰/ä¿®æ”¹çš„å±æ€§åç§°æˆ–Symbol
3. descriptor: è¦å®šä¹‰/ä¿®æ”¹çš„å±æ€§æè¿°ç¬¦

**è¿”å›å€¼ï¼š**
è¢«ä¼ é€’ç»™æ–¹æ³•ä¸­çš„obj

#### æ–¹æ³•ä½¿ç”¨

##### åˆ›å»ºå±æ€§
å¦‚æœå¯¹è±¡ä¸­ä¸å­˜åœ¨æŒ‡å®šçš„å±æ€§ï¼Œ`Object.defineProperty()`ä¼šåˆ›å»ºè¿™ä¸ªå±æ€§ï¼Œå½“æè¿°ç¬¦ä¸­çœç•¥æŸäº›å­—æ®µæ—¶ï¼Œè¿™äº›å­—æ®µå°†ä½¿ç”¨å®ƒä»¬çš„é»˜è®¤å€¼
```javascript
  var o = {};
  Object.defineProperty(o, 'a', {
  	value: 2,
  	writable: true,
  	enumerable: true,
  	configurable: true
  });
  // ğŸ‘†åœ¨å¯¹è±¡oä¸­æ·»åŠ ä¸€ä¸ªå±æ€§ä¸å¯¹åº”çš„å±æ€§æè¿°ç¬¦å¯¹è±¡ï¼Œç­‰åŒäºo.a = 2;
  var xx = 3;
  Object.defineProperty(o, 'b', {
  	get(){ return xx; },
  	set(newVal){ xx = newVal },
  	enumerable: true,
  	configurable: true
  });
  // ğŸ‘†åœ¨å¯¹è±¡ä¸­åˆ›å»ºäº†ä¸€ä¸ªbå±æ€§ä»¥åŠå¯¹åº”çš„æè¿°ç¬¦ï¼Œå¹¶åˆ©ç”¨xxä¸­é—´å˜é‡æ¥è¿›è¡Œå±æ€§çš„å­˜/å–
  Object.defineProperty(o, 'c', {
  	value: 123,
  	get(){ return 456; }
  })
  // ğŸ‘†å°†ä¼šæŠ¥é”™ï¼Œå› ä¸ºä¸èƒ½åŒæ—¶æä¾›å¯¹å±æ€§å€¼çš„ä¸¤ç§ä¸åŒå–å€¼æ–¹å¼
```
##### è‡ªå®šä¹‰getterså’Œsetters
```javascript
  function Archiver() {
    var temperature = null;
    var archive = [];
    // è¿™é‡ŒthisæŒ‡å‘è°ƒç”¨è€…ï¼Œç”±äºä½¿ç”¨çš„newå…³é”®è¯æ¥åˆ›å»ºçš„å¯¹è±¡ï¼Œå› æ­¤ä¼šæŒ‡å‘å¯¹åº”å®ä¾‹å¯¹è±¡
    Object.defineProperty(this, 'temperature', {
    	get(){
    		console.info('get!');
    		return temperature;
    	},
    	set(newVal){
    		temperature = newVal;
    		archive.push({
    		  val: temperature
    		});
    	}
    });
    this.getArchive = function() {
      return archive;
    }
  }
  var arc = new Archiver();
  arc.temperature;  // get!
  arc.temperature = 123;
  arc.temperature = 456;
  arc.getArchive(); // [{val: 123}, {val: 456}]
```
![è‡ªå®šä¹‰getterå’Œsetterç»“æœ](è‡ªå®šä¹‰getterå’Œsetterç»“æœ.png)

é€šè¿‡è‡ªå®šä¹‰getterså’Œsettersï¼Œåˆ©ç”¨temperatureå˜é‡æ¥æä¾›å¯¹è±¡è‡ªèº«å±æ€§çš„ä¸€ä¸ªå­˜/å–æ“ä½œï¼Œè¿™é‡Œå¯ä»¥å°è£…è‡ªèº«çš„å¾ˆå¤šé€»è¾‘åœ¨å…¶ä¸­ã€‚

##### å±æ€§ç»§æ‰¿
```javascript
  function MyClass() {
  }
  var value;
  Object.defineProperty(MyClass.prototype, "x", {
  	get(){ return value; },
  	set(newVal){ value=newVal; }
  });
  var o1 = new MyClass();
  var o2 = new MyClass();
  o1.x = 1;
  console.info(o2.x); // 1
```
ğŸ‘†è¿™é‡Œçš„xæ˜¯å®šä¹‰åœ¨MyClassçš„prototypeå¯¹è±¡ä¸Šçš„ï¼Œå› è€Œå®ä¾‹å¯¹è±¡åˆ™å…±äº«äº†xçš„è®¿é—®ï¼Œæ‰€ä»¥o1æ”¹å˜äº†xä¹ŸåŒæ—¶æ”¹å˜äº†o2ä¸­çš„x
ğŸ¤”é‚£ä¹ˆé’ˆå¯¹ä¸Šé¢çš„è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆè°ƒæ•´ï¼Œæ‰èƒ½å¤Ÿè®©xç”±æ¯ä¸ªå®ä¾‹å¯¹è±¡å»æ‹¥æœ‰å‘¢ï¼Ÿ
```javascript
  // ...
  Object.defineProperty(MyClass.prototype, "x", {
  	get(){ return this.x1; },
  	set(newVal){ this.x1 = newVal }
  });
```
é€šè¿‡åœ¨å®šä¹‰xå±æ€§çš„æ—¶å€™ï¼Œå°†xæŒ‚åˆ°thisä¸Šï¼Œè€Œthisåˆ™æ˜¯æŒ‡å‘ç€newå‡ºæ¥çš„å®ä¾‹å¯¹è±¡ï¼Œå› æ­¤æ¯ä¸ªå®ä¾‹å¯¹è±¡éƒ½æ‹¥æœ‰å¯¹xçš„ä¸€ä»½æ•°æ®

### Object.definePropertyçš„ä½¿ç”¨åœºæ™¯
