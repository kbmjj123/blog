---
title: èŠ‚æµä¸é˜²æŠ–
author: Zhenggl
date: 2021-03-26 15:52:13
categories:
    - [å‰ç«¯, javascript, åŸºç¡€]
tags:
    - javascript
    - function
cover: debounce-cover.jpeg
---

### é—®é¢˜å¼•å…¥

**é—®é¢˜1ï¼š** å¦‚æœè¦å®ç°domèŠ‚ç‚¹çš„æ‹–æ‹½åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨ç»‘å®šæ‹–æ‹½äº‹ä»¶çš„æ—¶å€™å‘ç°æ¯å½“å…ƒç´ ç¨å¾®ç§»åŠ¨ä¸€ç‚¹ç‚¹å°±ä¼šè§¦å‘å¤§é‡çš„å›è°ƒå‡½æ•°ï¼Œå¯¼è‡´æµè§ˆå™¨ç›´æ¥å¡æ­»ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬åº”å’‹æ•´å‘¢ï¼Ÿ

**é—®é¢˜2ï¼š** å¦‚æœç»™ä¸€ä¸ªæŒ‰é’®ç»‘å®šäº†è¡¨å•æäº¤çš„postäº‹ä»¶ï¼Œä½†ç”¨æˆ·æœ‰æ—¶å€™åœ¨ç½‘ç»œæ¯”è¾ƒå·®çš„æƒ…å†µä¸‹å¤šæ¬¡ç‚¹å‡»æŒ‰é’®é€ æˆè¡¨å•é‡å¤æäº¤ï¼Œå¦‚æœé˜²æ­¢å¤šæ¬¡æäº¤äº‹ä»¶çš„å‘ç”Ÿï¼Ÿ

> ä¸ºäº†åº”å¯¹ä¸Šè¿°åœºæ™¯ï¼Œå˜å‡ºç°äº†å‡½æ•°é˜²æŠ–å’Œå‡½æ•°èŠ‚æµä¸¤ä¸ªæ¦‚å¿µï¼Œæ€»çš„æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯åœ¨æ—¶é—´è½´ä¸Šæ§åˆ¶å‡½æ•°çš„æ‰§è¡Œæ¬¡æ•°ã€‚

### å‡½æ•°é˜²æŠ–(debounce)
**æ¦‚å¿µï¼š** `åœ¨äº‹ä»¶è¢«è§¦å‘nç§’åå†æ‰§è¡Œå›è°ƒï¼Œå¦‚æœåœ¨è¿™nç§’å†…åˆè¢«è§¦å‘ï¼Œåˆ™é‡æ–°è®¡æ—¶ã€‚`

**ç”Ÿæ´»ä¸­çš„å®ä¾‹ï¼š** `å¦‚æœæœ‰äººè¿›ç”µæ¢¯(è§¦å‘äº‹ä»¶)ï¼Œé‚£ç”µæ¢¯åœ¨10ç§’é’Ÿåè§¦å‘(æ‰§è¡Œäº‹ä»¶ç›‘å¬å™¨)ï¼Œè¿™æ—¶å¦‚æœåˆæœ‰äººè¿›ç”µæ¢¯äº†(åœ¨10ç§’é’Ÿå†…å†æ¬¡è§¦å‘è¯¥äº‹ä»¶)ï¼Œåˆ™æˆ‘ä»¬åˆå¾—ç­‰å¾…10ç§’å†å‡ºå‘(é‡æ–°è®¡æ—¶)`

ä¸¾ä¸ªğŸŒ°ï¼š
```javascript
  // æ¨¡æ‹Ÿä¸€æ®µajaxè¯·æ±‚
  function ajax(content){
	console.log('ajax requst ' + content);
  }
  let inputA = document.getElementById('unDebounce');
  inputA.addEventListener('keyup', function(e){
      ajax(e.target.value);
  });
  
```
çœ‹ä¸€ä¸‹è¿™ä¸ªè¿è¡Œç»“æœï¼š

![æœªä½¿ç”¨é˜²æŠ–çš„](no-debounce-input.gif)

â¡ï¸ ä»ä¸Šè¿°ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåªè¦æˆ‘ä»¬æŒ‰ä¸‹è¿™ä¸ªé”®ç›˜ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªajaxè¯·æ±‚ï¼Œä¸ä»…ä»èµ„æºä¸Šæ¥è¯´è¿™ä¸ªæ˜¯å¾ˆæµªè´¹èµ„æºçš„è¡Œä¸ºï¼Œè€Œä¸”åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç”¨æˆ·ä¹Ÿæ˜¯è¾“å‡ºå®Œæˆçš„å­—ç¬¦åï¼Œæ‰ä¼šè¯·æ±‚çš„ã€‚
ä¸‹é¢æˆ‘ä»¬ä¼˜åŒ–ä¸€ä¸‹ï¼š
```javascript
  // æ¨¡æ‹Ÿä¸€æ®µajaxè¯·æ±‚
  function ajax(content){
	console.log('ajax requst ' + content);
  }
  function debounce(fun, delay){
	return function(args){
		var $this = this;
		var $args = args;
		clearTimeout(fun.id);
		fun.id = setTimeout(function(){
			fun.call($this, $args);
		}, delay)
	}
  }
  var inputB = document.getElementById('debounce');
  var debounceAjax = debounce(ajax, 500);
  inputB.addEventListener('keyup', function (ev) { 
  	debounceAjax(e.target.value);
   });
```
å†çœ‹ä¸€ä¸‹è¿™ä¸ªè¿è¡Œç»“æœï¼š

![ä½¿ç”¨äº†é˜²æŠ–çš„å‡½æ•°](debounce-input.gif)

å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å‡å¦‚äº†é˜²æŠ–ä¹‹åï¼Œå½“é¢‘ç¹è¾“å…¥çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šå‘é€è¯·æ±‚ï¼Œåªæœ‰å½“æˆ‘ä»¬åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…æ²¡æœ‰è¾“å…¥æ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå‡½æ•°ï¼Œå¦‚æœåœæ­¢è¾“å…¥ä½†æ˜¯åœ¨æŒ‡å®šçš„äº‹ä»¶é—´éš”å†…åˆè¾“å…¥ï¼Œä¼šé‡æ–°è§¦å‘è®¡æ—¶ã€‚

å†çœ‹ä»¥ä¸‹è¿™ä¸ªğŸŒ°ï¼š
```javascript
  var biu = function(){
	var date=new Date();
	console.info('biu biu biu', date.getHours() + ':' + date.getSeconds());
  };
  var boom = function (){
  	var date=new Date();
  	console.info('boom boom boom', date.getHours() + ':' + date.getSeconds());
  };
  setInterval(debounce(biu, 500), 1000);
  setInterval(debounce(boom, 2000), 1000);
```
å†çœ‹çœ‹ä¸Šè¿°ä»£ç çš„è¿è¡Œç»“æœ

![ä½¿ç”¨äº†setIntervalæ¥é…åˆdebounce](setInterval-debounce.gif)

è¿™ä¸ªğŸŒ°å°±å¾ˆå¥½çš„è§£é‡Šäº†ï¼Œå¦‚æœåœ¨äº‹ä»¶é—´éš”å†…æ‰§è¡Œå‡½æ•°ï¼Œå°±ä¼šé‡æ–°è§¦å‘è®¡æ—¶ï¼ŒğŸ‘†biu ä¼šåœ¨ç¬¬1.5sæ‰§è¡Œåï¼Œæ¯éš”1sæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œboomä¸€æ¬¡ä¹Ÿä¸ä¼šæ‰§è¡Œï¼Œå› æ­¤å®ƒçš„é˜²æŠ–çš„æ—¶é—´é—´éš”æ˜¯2sï¼Œè€Œæ‰§è¡Œæ—¶é—´æ˜¯1sï¼Œæ‰€ä»¥è®¡æ—¶å™¨æ¯æ¬¡éƒ½ä¼šè¢«é‡æ–°å¼€å§‹æ¿€æ´»

### å‡½æ•°èŠ‚æµ(throttle)
**æ¦‚å¿µï¼š** `è§„å®šä¸€ä¸ªå•ä½äº‹ä»¶ï¼Œåœ¨è¿™ä¸ªå•ä½äº‹ä»¶å†…ï¼Œåªèƒ½æœ‰ä¸€æ¬¡è§¦å‘äº‹ä»¶å¾—å›è°ƒå‡½æ•°æ‰§è¡Œï¼Œå¦‚æœåŒä¸€ä¸ªå•ä½æ—¶é—´å†…æŸäº‹ä»¶è¢«è§¦å‘å¤šæ¬¡ï¼Œåªæœ‰ä¸€æ¬¡èƒ½ç”Ÿæ•ˆ`

çœ‹ä¸€ä¸ªğŸŒ°ï¼š

```javascript
  function throttle(fun, delay){
	var last, deferTimer;
	return function(args){
		var $this = this;
		var $args = args;
		var now = +new Date();
		if(last && now < last + delay){
			clearTimeout(deferTimer);
			deferTimer = setTimeout(function(){
				last = now;
				fun.call($this, $args);
			}, delay);
		}else{
			last = now;
			fun.call($this, $args);
		}
	}
  }
  var throttleAjax = throttle(ajax, 1000);
  var inputC = document.getElementById('throttle');
  inputC.addEventListener('keyup', function(e){
  	throttleAjax(e.target.value);
  })
```
çœ‹ä¸‹è¿™ä¸ªè¿è¡Œç»“æœï¼š

![throttleè¿è¡Œç»“æœ](throttle.gif)

ä»ğŸ‘†å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¸æ–­è¾“å…¥æ—¶ï¼Œajaxä¼šæŒ‰ç…§æˆ‘ä»¬è®¾å®šçš„æ—¶é—´ï¼Œæ¯1sæ‰§è¡Œä¸€æ¬¡ï¼Œç›´æ¥å¿½ç•¥æˆ‘ä»¬ç–¯ç‹‚è¾“å…¥çš„è¿‡ç¨‹ï¼Œç›´æ¥1såˆ°äº†ï¼Œå°±æ‹¿å½“å‰è¾“å…¥æ¡†ä¸­çš„å€¼

### æ€»ç»“
+ å‡½æ•°é˜²æŠ–å’Œå‡½æ•°èŠ‚æµéƒ½æ˜¯é˜²æ­¢æŸä¸€æ—¶é—´é¢‘ç¹è§¦å‘ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªåŠ¨ä½œä¹‹é—´çš„åŸç†æ˜¯ä¸ä¸€æ ·çš„ï¼›
+ å‡½æ•°é˜²æŠ–æ˜¯æŸä¸€æ®µæ—¶é—´å†…åªæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œå‡½æ•°èŠ‚æµæ˜¯é—´éš”æ—¶é—´æ‰§è¡Œã€‚

#### ç»“åˆå®é™…åº”ç”¨åœºæ™¯
+ debounce
  - searchæœç´¢è”æƒ³ï¼Œç”¨æˆ·åœ¨ä¸æ–­è¾“å…¥å€¼æ—¶ï¼Œç”¨é˜²æŠ–æ¥èŠ‚çº¦è¯·æ±‚èµ„æºï¼›
  - windowè§¦å‘resizeçš„æ—¶å€™ï¼Œä¸æ–­çš„è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°ä¼šä¸æ–­è§¦å‘è¿™ä¸ªäº‹ä»¶ï¼Œç”¨é˜²æŠ–æ¥è®©å…¶åªè§¦å‘ä¸€æ¬¡ï¼›
  - ç»™æŒ‰é’®åŠ å‡½æ•°é˜²æŠ–é˜²æ­¢è¡¨å•å¤šæ¬¡æäº¤
  - åˆ¤æ–­`scroll`æ˜¯å¦æ»‘åŠ¨åˆ°åº•éƒ¨ï¼Œ`æ»šåŠ¨æ—¶é—´` + `å‡½æ•°é˜²æŠ–`
+ throttle
  - é¼ æ ‡ä¸æ–­ç‚¹å‡»è§¦å‘ï¼Œmousedown(å•ä½æ—¶é—´å†…åªè§¦å‘ä¸€æ¬¡)
  - DOMå…ƒç´ æ‹–æ‹½
  - Canvasç”»ç¬”åŠŸèƒ½
> é€‚åˆ**å¤§é‡äº‹ä»¶**æŒ‰æ—¶é—´åšå¹³å‡åˆ†é…è§¦å‘
